# 10. Encadeamento (Chaining)

Outra forma de aumentarmos o tempo de processamento de uma informação pelo modelo é quebrando um prompt em prompts menores e mais específicos. Essa técnica é fundamental ao criarmos aplicações mais sofisticadas, como ChatBots que analisam dados proprietários para gerar uma resposta ao cliente.

Vamos seguir no mesmo exemplo da aula anterior. Uma forma ainda melhor de chegar a respostas estáveis para prompts como o anterior, que verifica se a resolução de um problema foi realizada corretamente, seria:
- Criando um prompt para a resolução do problema em si
- E depois passando a resposta obtida anteriormente para um novo prompt que compararia com a solução do aluno

```python
Solucione a pergunta abaixo: 

Pergunta:
Estou construindo uma instalação de energia solar e preciso de ajuda com as contas de custos as finanças.
- O terreno custa R$ 100 / metro quadrado
- Posso comprar painéis solares por R$ 250 / metro quadrado
- Negociei um contrato de manutenção que me custará R$ 100 mil por ano e  R$ 10 adicionais por metro quadrado

Qual é o custo total para o primeiro ano de operações em função do número de metros quadrados.

Solução:
```

E a resposta foi:

```python
Vamos chamar o número de metros quadrados de "x".

O custo total será a soma dos custos do terreno, dos painéis solares e da manutenção.

Custo do terreno: R$ 100 * x
Custo dos painéis solares: R$ 250 * x
Custo da manutenção: R$ 100.000 + R$ 10 * x

Custo total = Custo do terreno + Custo dos painéis solares + Custo da manutenção
Custo total = R$ 100x + R$ 250x + R$ 100.000 + R$ 10x
Custo total = R$ 360x + R$ 100.000

Portanto, o custo total para o primeiro ano de operações em função do número de metros quadrados será de R$ 360x + R$ 100.000.
```

E agora vamos passar a solução do modelo e compará-la ao do aluno:

```python
Determine se a solução do aluno está correta ou não.

Pergunta:
Estou construindo uma instalação de energia solar e preciso de ajuda com as contas de custos as finanças.
- O terreno custa R$ 100 / metro quadrado
- Posso comprar painéis solares por R$ 250 / metro quadrado
- Negociei um contrato de manutenção que me custará R$ 100 mil por ano e  R$ 10 adicionais por metro quadrado

Qual é o custo total para o primeiro ano de operações
em função do número de pés quadrados.

Solução correta:
Vamos chamar o número de metros quadrados de "x".

O custo total será a soma dos custos do terreno, dos painéis solares e da manutenção.

Custo do terreno: R$ 100 * x
Custo dos painéis solares: R$ 250 * x
Custo da manutenção: R$ 100.000 + R$ 10 * x

Custo total = Custo do terreno + Custo dos painéis solares + Custo da manutenção
Custo total = R$ 100x + R$ 250x + R$ 100.000 + R$ 10x
Custo total = R$ 360x + R$ 100.000

Portanto, o custo total para o primeiro ano de operações em função do número de metros quadrados será de R$ 360x + R$ 100.000.


Solução do aluno:
Seja x o tamanho da instalação em metros quadrados.
Custos:
1. Custo do terreno: 100x
2. Custo do painel solar: 250x
3. Custo de manutenção: 100.000 + 100x
Custo total: 100x + 250x + 100.000 + 100x = 450x + 100.000
```

E a resposta final é:

```python
A solução do aluno está incorreta. O custo total calculado pelo aluno está incorreto. A forma correta de calcular o custo total para o primeiro ano de operações em função do número de metros quadrados é R$ 360x + R$ 100.000, como apresentado na solução correta.
```

E a beleza de quebrarmos em prompts mais específicos é podermos melhorar cada prompt individualmente. Digamos que eu perceba que a primeira etapa não está sendo realizada corretamente pelo modelo e as soluções não estão corretas, eu poderia iterativamente melhorar o primeiro prompt até que ele começasse a dar respostas mais estáveis. O mesmo processo eu poderia fazer com o segundo. Com duas tarefas isoladas, nós podemos entender melhor onde o modelo está errando e atacar aquela etapa individualmente, sem afetar outras onde o modelo já executa bem.

## Cadeias de Roteamento

Você já deve ter percebido o poder do encadeamento de prompts, mas podemos dar um passo a mais com o roteamento de cadeias. A ideia é criarmos um meio de campo que decide qual será o próximo prompt utilizado, baseado na pergunta anterior. É algo como um serviço de triagem. Digamos que eu entre em um hospital com alguma doença. A primeira etapa é sempre a triagem, onde será decidido para qual especialista eu serei encaminhado. O roteamento é exatamente esta triagem. Vamos a um exemplo:

```python
Você é responsável por categorizar as dúvidas que chegam a você nas seguintes categorias: matemática, física e química. Caso a dúvida não esteja relacionada a nenhuma das categorias anteriores, você responde "Indefinido".
Dúvida: O que é trigonometria?
Resposta: matemática
Dúvida: Quando eu uso uma crase?
Reposta: Indefinido
Dúvida: Qual é a segunda Lei de Newton?
Resposta:
```

```python
física
```

Agora, podemos criar um script que processe a resposta do modelo e direcione a um prompt específico, dependendo da categoria.

```python
Você é um professor de física de ensino médio. Você sempre responde as dúvidas de seus alunos com um embasamento teórico e um exemplo prático. Você também sempre propoe atividades extra classe para os alunos entenderem melhor os conceitos ensinados.
Repsponda a dúvida a seguir:

Dúvida: Qual é a segunda Lei de Newton?
Resposta:
```

```python
A segunda Lei de Newton, também conhecida como Lei Fundamental da Dinâmica, estabelece que a aceleração de um objeto é diretamente proporcional à força resultante que age sobre ele e inversamente proporcional à sua massa, sendo a direção da aceleração a mesma que a da força resultante. Essa lei é matematicamente representada pela equação F = m*a, onde F é a força resultante, m é a massa do objeto e a é a aceleração.

Um exemplo prático para compreender a segunda Lei de Newton é o seguinte: imagine um carro em movimento que precisa frear bruscamente para evitar um acidente. A força resultante atuando sobre o carro é a força de atrito dos freios, que vai gerar uma aceleração negativa (desaceleração) no veículo. Quanto maior for a força de atrito (F) e menor a massa do carro (m), maior será a aceleração (a) gerada, fazendo com que o carro pare mais rapidamente. 

Uma atividade extra classe que sugiro é a construção de um experimento simples para comprovar a segunda Lei de Newton, como por exemplo, utilizar um carrinho de brinquedo em uma superfície plana e lisa, variando a força aplicada e a massa do objeto para observar a relação entre a força, a aceleração e a massa.
```

Pense em diversas aplicações que poderíamos criar a partir disso. Poderíamos criar um chatbot completo para uma loja, que categoriza os setores da loja e passa para especialistas, que detêm as especificações de produtos diferentes, criando respostas especializadas. Acredito que a técnica de encadeamento seja a mais fundamental para criar aplicações reais e de valor.
